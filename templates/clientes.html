{% extends "base.html" %}
{% block title %}Clientes{% endblock %}

{% block content %}
<!-- Botón para desplegar el form -->
<button class="btn btn-primary mb-3" data-bs-toggle="collapse" data-bs-target="#formCliente">
  + Nuevo Cliente
</button>

<form action="{{ url_for('clientes.nuevo_cliente') }}" method="POST">
  <div class="collapse mb-3" id="formCliente">
    <div class="card card-body bg-dark text-light">
      <!-- Nombre -->
      <div class="mb-2">
        <label for="nombre" class="form-label">Nombre del Cliente</label>
        <input type="text" name="nombre" id="nombre" class="form-control form-control-sm" required
          placeholder="Nombre del cliente" autocomplete="off">
      </div>

      <!-- Teléfono -->
      <div class="mb-2">
        <label for="telefono" class="form-label">Teléfono</label>
        <input type="text" name="telefono" id="telefono" class="form-control form-control-sm"
          placeholder="Teléfono del cliente" autocomplete="off">
      </div>

      <!-- Dirección -->
      <div class="mb-2">
        <label for="direccion" class="form-label">Dirección</label>
        <input type="text" name="direccion" id="direccion" class="form-control form-control-sm"
          placeholder="Dirección del cliente" autocomplete="off">
      </div>

      <!-- Email -->
      <div class="mb-2">
        <label for="mail" class="form-label">Email</label>
        <input type="email" name="mail" id="mail" class="form-control form-control-sm"
          placeholder="Email del cliente (opcional)" autocomplete="off">
      </div>

      <!-- Botón de envío -->
      <button type="submit" class="btn btn-success btn-sm">💾 Guardar Cliente</button>
    </div>
  </div>
</form>
<!-- Lista de clientes -->
<div class="accordion" id="agendaClientes">
  {% for c in clientes %}
  <div class="accordion-item bg-dark text-light border-0 mb-2 rounded">
    <h2 class="accordion-header" id="heading{{ loop.index }}">
      <button class="accordion-button collapsed bg-dark text-light" type="button" data-bs-toggle="collapse"
        data-bs-target="#collapse{{ loop.index }}" aria-expanded="false" aria-controls="collapse{{ loop.index }}">
        📇 {{ c[1] }}
      </button>
    </h2>
    <div id="collapse{{ loop.index }}" class="accordion-collapse collapse" aria-labelledby="heading{{ loop.index }}"
      data-bs-parent="#agendaClientes">
      <div class="accordion-body">
        <form method="POST" action="{{ url_for('clientes.editar_cliente', id_cliente=c[0]) }}" class="edit-form">
          <!-- Teléfono -->
          <div class="mb-2 d-flex align-items-center justify-content-between">
            <div>
              📞 <strong>Tel:</strong>
              <span class="editable-text" data-target="telefono-{{ c[0] }}">{{ c[2] or "Sin teléfono" }}</span>
            </div>
            <button type="button" class="icon-btn" onclick="toggleEdit(this, 'telefono-{{ c[0] }}')">
              <i class="fas fa-pen"></i>
            </button>
          </div>
          <input type="text" name="telefono" value="{{ c[2] or '' }}" class="form-control form-control-sm d-none"
            id="input-telefono-{{ c[0] }}" autocomplete="off">

          <!-- Dirección -->
          <div class="mb-2 d-flex align-items-center justify-content-between">
            <div>
              🏠 <strong>Dirección:</strong>
              <span class="editable-text" data-target="direccion-{{ c[0] }}">{{ c[3] or "Sin dirección" }}</span>
            </div>
            <button type="button" class="icon-btn" onclick="toggleEdit(this, 'direccion-{{ c[0] }}')">
              <i class="fas fa-pen"></i>
            </button>
          </div>
          <input type="text" name="direccion" value="{{ c[3] or '' }}" class="form-control form-control-sm d-none"
            id="input-direccion-{{ c[0] }}" autocomplete="off">

          <!-- Email -->
          <div class="mb-2 d-flex align-items-center justify-content-between">
            <div>
              ✉️ <strong>Email:</strong>
              <span class="editable-text" data-target="mail-{{ c[0] }}">{{ c[4] or "Sin email" }}</span>
            </div>
            <button type="button" class="icon-btn" onclick="toggleEdit(this, 'mail-{{ c[0] }}')">
              <i class="fas fa-pen"></i>
            </button>
          </div>
          <input type="email" name="mail" value="{{ c[4] or '' }}" class="form-control form-control-sm d-none"
            id="input-mail-{{ c[0] }}" autocomplete="off">

          <!-- Botones -->
          <div class="text-end mt-2">
            <button class="btn btn-success btn-sm">💾 Guardar</button>
            <a href="{{ url_for('clientes.borrar_cliente', id_cliente=c[0]) }}" class="btn btn-danger btn-sm">🗑️
              Borrar</a>
          </div>
        </form>
      </div>
    </div>
  </div>
  {% endfor %}
</div>
{% endblock %}